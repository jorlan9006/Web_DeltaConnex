<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Untitled Page</title>
<meta name="generator" content="WYSIWYG Web Builder 20 - https://www.wysiwygwebbuilder.com">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="delta_connex.css" rel="stylesheet">
<link href="Analytics.css" rel="stylesheet">
</head>
<body>
<div id="wb_LayoutGrid3">
<div id="LayoutGrid3">
<div class="col-1">
<div id="wb_LayoutGrid2">
<div id="LayoutGrid2">
<div class="col-1">
<picture id="wb_Picture1" style="display:block;width: 100%;height:38px;z-index:0">
<img src="logo.png" id="Picture1" alt="" width="39" height="34">
</picture>
</div>
<div class="col-2">
<hr id="HorizontalLine1" style="display:inline-block;width:216px;z-index:1;">
<div id="wb_Text1">
<span style="color:#000000;font-family:Arial;font-size:16px;"><strong>DELTA CONNEX</strong></span>
</div>
</div>
</div>
</div>
</div>
<div class="col-2">
<div id="FlexContainer1">
<button type="submit" id="ThemeableButton3" name="" value="Money" class="ui-button ui-corner-all" style="display:block;width:74px;height:22px;z-index:4;">Money</button>
<button type="submit" id="ThemeableButton4" name="" value="Percentage" class="ui-button ui-corner-all" style="display:block;width:74px;height:22px;z-index:5;">Percentage</button>
</div>
</div>
<div class="col-3">
</div>
</div>
</div>
<div id="wb_LayoutGrid5">
<div id="LayoutGrid5">
<div class="row">
<div class="col-1">
<hr id="HorizontalLine2" style="display:inline-block;width:160px;z-index:28;">
<div id="wb_LayoutGrid6">
<div id="LayoutGrid6">
<div class="row">
<div class="col-1">
<div id="wb_Text2">
<span style="color:#424851;font-family:Arial;font-size:13px;"><strong>GENERAL</strong></span>
</div>
</div>
</div>
</div>
</div>
<div id="wb_LayoutGrid4" onclick="window.location.href='./Dashboard.html';return false;">
<div id="LayoutGrid4">
<div class="col-1">
<div id="wb_Icon1" style="display:inline-block;width:14px;height:22px;text-align:center;z-index:8;">
<div id="Icon1"><i class="Icon1"></i></div>
</div>
</div>
<div class="col-2">
<input type="submit" id="Button2" name="" value="Dashboard" style="display:block;width: 100%;;height:19px;z-index:9;">
</div>
</div>
</div>
<div id="wb_LayoutGrid7" onclick="window.location.href='./Calendar.html';return false;">
<div id="LayoutGrid7">
<div class="col-1">
<div id="wb_Icon2" style="display:inline-block;width:14px;height:22px;text-align:center;z-index:10;">
<div id="Icon2"><i class="Icon2"></i></div>
</div>
</div>
<div class="col-2">
<input type="submit" id="Button1" name="" value="Calendar  " style="display:block;width: 100%;;height:19px;z-index:11;">
</div>
</div>
</div>
<div id="wb_LayoutGrid1" onclick="window.location.href='#';return false;">
<div id="LayoutGrid1">
<div class="col-1">
<div id="wb_Icon3" style="display:inline-block;width:14px;height:25px;text-align:center;z-index:12;">
<div id="Icon3"><i class="Icon3"></i></div>
</div>
</div>
<div class="col-2">
<input type="submit" id="Button3" name="" value="Accounts   " style="display:block;width: 100%;;height:19px;z-index:13;">
</div>
</div>
</div>
<div id="wb_LayoutGrid8">
<div id="LayoutGrid8">
<div class="row">
<div class="col-1">
<div id="wb_Text8">
<span style="color:#424851;font-family:Arial;font-size:13px;"><strong>TRADING</strong></span>
</div>
</div>
</div>
</div>
</div>
<div id="wb_LayoutGrid10" onclick="window.location.href='./Trades.html';return false;">
<div id="LayoutGrid10">
<div class="col-1">
<div id="wb_Icon5" style="display:inline-block;width:14px;height:22px;text-align:center;z-index:15;">
<div id="Icon5"><i class="Icon5"></i></div>
</div>
</div>
<div class="col-2">
<input type="submit" id="Button4" name="" value="Trades   " style="display:block;width: 100%;;height:19px;z-index:16;">
</div>
</div>
</div>
<div id="wb_LayoutGrid11" onclick="window.location.href='./Analytics.html';return false;">
<div id="LayoutGrid11">
<div class="col-1">
<div id="wb_Icon6" style="display:inline-block;width:14px;height:22px;text-align:center;z-index:17;">
<div id="Icon6"><i class="Icon6"></i></div>
</div>
</div>
<div class="col-2">
<input type="submit" id="Button5" name="" value="Analytics " style="display:block;width: 100%;;height:19px;z-index:18;">
</div>
</div>
</div>
<div id="wb_LayoutGrid9" onclick="window.location.href='./Progress-Tracker.html';return false;">
<div id="LayoutGrid9">
<div class="col-1">
<div id="wb_Icon4" style="display:inline-block;width:14px;height:22px;text-align:center;z-index:19;">
<div id="Icon4"><i class="Icon4"></i></div>
</div>
</div>
<div class="col-2">
<input type="submit" id="Button6" name="" value="Progress Tracker " style="display:block;width: 100%;;height:19px;z-index:20;">
</div>
<div class="col-3">
<label for="" id="Label2" style="display:block;width:100%;line-height:12px;z-index:21;">NEW</label>
</div>
</div>
</div>
<div id="wb_LayoutGrid12">
<div id="LayoutGrid12">
<div class="row">
<div class="col-1">
<div id="wb_Text12">
<span style="color:#424851;font-family:Arial;font-size:13px;"><strong>STRATEGY</strong></span>
</div>
</div>
</div>
</div>
</div>
<div id="wb_LayoutGrid13" onclick="window.location.href='./Strategies.html';return false;">
<div id="LayoutGrid13">
<div class="col-1">
<div id="wb_Icon7" style="display:inline-block;width:14px;height:22px;text-align:center;z-index:23;">
<div id="Icon7"><i class="Icon7"></i></div>
</div>
</div>
<div class="col-2">
<input type="submit" id="Button7" name="" value="Strategies" style="display:block;width: 100%;;height:19px;z-index:24;">
</div>
</div>
</div>
<div id="wb_LayoutGrid14" onclick="window.location.href='./Backtesting.html';return false;">
<div id="LayoutGrid14">
<div class="col-1">
<div id="wb_Icon8" style="display:inline-block;width:14px;height:21px;text-align:center;z-index:25;">
<div id="Icon8"><i class="Icon8"></i></div>
</div>
</div>
<div class="col-2">
<input type="submit" id="Button8" name="" value="Backtesting" style="display:block;width: 100%;;height:19px;z-index:26;">
</div>
<div class="col-3">
<label for="" id="Label1" style="display:block;width:100%;line-height:12px;z-index:27;">soon</label>
</div>
</div>
</div>
</div>
<div class="col-2">
<div id="wb_LayoutGrid16">
<div id="LayoutGrid16">
<div class="col-1">
<div id="wb_LayoutGrid15">
<div id="LayoutGrid15">
<div class="row">
<div class="col-1">
<div id="wb_Text3">
<span style="color:#000000;font-family:Arial;font-size:21px;"><strong>Analytics</strong></span>
</div>
</div>
</div>
</div>
</div>
<div id="wb_LayoutGrid19">
<div id="LayoutGrid19">
<div class="col-1">
<div id="Html1" style="display:inline-block;width:100%;height:393px;overflow:hidden;z-index:41">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>P&L Over Time</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </head>
<body>

    <div class="chart-container">
        <canvas id="plChart"></canvas>
    </div>

    <script>
        const ctx = document.getElementById('plChart').getContext('2d');

        const data = {
            labels: ['7/1', '9/1', '12/1', '15/1', '17/1', '20/1', '23/1', '28/1', '30/1', '4/2', '6/2'],
            datasets: [{
                label: 'P&L Over Time',
                data: [0, 2200, 2300, 4700, 3900, 5000, 4300, 6000, 8000, 7700, 7200],
                fill: true,
                borderColor: '#1cc4c4',
                backgroundColor: 'rgba(28, 196, 196, 0.1)',
                tension: 0.4
            }]
        };

        const config = {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + (value / 1000) + 'k';
                            },
                            font: {
                                size: 10
                            }
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                size: 10
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        bodyFont: {
                            size: 10
                        },
                        titleFont: {
                            size: 10
                        }
                    }
                }
            }
        };

        new Chart(ctx, config);
    </script>

</body>
</html>
</div>
</div>
</div>
</div>
<div id="wb_LayoutGrid17">
<div id="LayoutGrid17">
<div class="row">
<div class="col-1">
<div id="wb_Text5">
<span style="color:#000000;font-family:Arial;font-size:16px;"><strong>Metrics and Graphs</strong></span>
</div>
</div>
</div>
</div>
</div>
<div id="wb_LayoutGrid20">
<div id="LayoutGrid20">
<div class="col-1">
<div id="Html2" style="display:inline-block;width:100%;height:404px;overflow:auto;z-index:43">
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>P&L Over Time</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
<body>
  <div class="chart-container">
    <h2>P&L Over Time</h2>
    <canvas id="pnlChart"></canvas>
  </div>

  <script>
    async function fetchDataAndRenderChart() {
      try {
        const res = await fetch("http://127.0.0.1:8000/dashboard/data");
        const data = await res.json();

        const allTrades = [];
        Object.values(data).forEach(account => {
          if (Array.isArray(account.history)) {
            allTrades.push(...account.history);
          }
        });

        const groupedByDay = {};
        allTrades.forEach(trade => {
          const date = new Date(trade.time * 1000).toLocaleDateString();
          const profit = Number(trade.profit) || 0;
          if (!groupedByDay[date]) groupedByDay[date] = 0;
          groupedByDay[date] += profit;
        });

        const sortedDates = Object.keys(groupedByDay).sort((a, b) => new Date(a) - new Date(b));
        const labels = [];
        const pnlData = [];
        let cumulativePnl = 0;

        sortedDates.forEach(date => {
          cumulativePnl += groupedByDay[date];
          labels.push(date);
          pnlData.push(cumulativePnl.toFixed(2));
        });

        const ctx = document.getElementById("pnlChart").getContext("2d");
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: 'Cumulative P&L',
              data: pnlData,
              fill: true,
              backgroundColor: 'rgba(0, 200, 255, 0.1)',
              borderColor: '#00bcd4',
              tension: 0.4,
              pointRadius: 0
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              x: {
                ticks: {
                  color: '#666'
                }
              },
              y: {
                ticks: {
                  color: '#666',
                  callback: value => `$${value}`
                },
                grid: {
                  color: 'rgba(0,0,0,0.05)'
                }
              }
            }
          }
        });

      } catch (error) {
        document.body.innerHTML += `<p class="error">❌ Error al obtener datos del backend.</p>`;
        console.error("Fetch error:", error);
      }
    }

    fetchDataAndRenderChart();
  </script>
</body>
</html>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>